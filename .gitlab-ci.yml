stages:
  - unit-test
  - acceptance-test
  - deploy

unit-test:
  image: node:latest
  stage: unit-test
  script:
    - npm i
    - npm test
  artifacts:
    reports:
      junit: junit.xml
      cobertura: coverage/cobertura.xml
   

acceptance-test:
  image: cypress/browsers:node16.14.0-slim-chrome99-ff97
  stage: acceptance-test
  script:
    - npm i
    - export CYPRESS_HOST=http://localhost:3000
    - npm start & npx wait-on $CYPRESS_HOST
    - npm run cypress:run

deplloy:
  image: cypress/browsers:node16.14.0-slim-chrome99-ff97
  stage: deploy
  script:
    - npm i
    - npm run build
    - npm install -g serverless
    - serverless deploy --no-confirm
    - export CYPRESS_HOST=http://coolweb.s3-website-us-east-1.amazonaws.com
    - npm run cypress:run

  environment:
    name: staging
    url: http://coolweb.s3-website-us-east-1.amazonaws.com/ 